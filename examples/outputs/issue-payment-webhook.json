{
  "issue_number": 1,
  "title": "fix: payment webhook not updating order status",
  "summary": "Orders remain in 'processing' state indefinitely after successful payment. The webhook handler exists but is not registered with Express routing.",
  "root_cause": "The payment webhook handler in apps/backend/src/webhooks/payment.ts is implemented but never imported or registered in server.ts. When Stripe (simulated) sends payment.succeeded events, they hit a 404.",
  "affected_files": [
    {
      "path": "apps/backend/src/server.ts",
      "reason": "Missing webhook route registration",
      "line_range": "5-6, 18-19"
    },
    {
      "path": "apps/backend/src/webhooks/payment.ts",
      "reason": "Webhook handler implementation (correct, just not wired up)",
      "line_range": "entire file"
    },
    {
      "path": "apps/backend/src/services/order.service.ts",
      "reason": "Order status update logic that webhook should trigger",
      "line_range": "50-61"
    }
  ],
  "implementation_approach": "1. Import payment webhook router in server.ts (line 5). 2. Register route at /api/webhooks by uncommenting line 18-19. 3. Verify webhook payload validation in payment.ts. 4. Test with curl to simulate webhook.",
  "test_strategy": "1. Unit test: Mock webhook payload to order service, verify status updates. 2. Integration test: POST to /api/webhooks/payment with valid payload, verify order status in database. 3. Manual test: Create order, simulate webhook with curl, check status updates on frontend within 2s.",
  "constraints": [
    "Must validate webhook signature in production (not required for demo)",
    "Should handle idempotent webhook delivery (multiple calls with same paymentIntentId)",
    "Frontend polling interval is 2s, so status change must be detectable within that window"
  ]
}
